<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: RNNSeq2Seq Pages: 1 -->
<svg width="2168pt" height="327pt"
 viewBox="0.00 0.00 2168.00 327.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 323)">
<title>RNNSeq2Seq</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-323 2164,-323 2164,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_enc</title>
<path fill="none" stroke="#cccccc" d="M20,-8C20,-8 543,-8 543,-8 549,-8 555,-14 555,-20 555,-20 555,-121 555,-121 555,-127 549,-133 543,-133 543,-133 20,-133 20,-133 14,-133 8,-127 8,-121 8,-121 8,-20 8,-20 8,-14 14,-8 20,-8"/>
<text text-anchor="middle" x="281.5" y="-121" font-family="Times,serif" font-size="10.00">Encoder (2&#45;layer BiLSTM)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_attn</title>
<path fill="none" stroke="#cccccc" d="M437,-141C437,-141 1230,-141 1230,-141 1236,-141 1242,-147 1242,-153 1242,-153 1242,-200 1242,-200 1242,-206 1236,-212 1230,-212 1230,-212 437,-212 437,-212 431,-212 425,-206 425,-200 425,-200 425,-153 425,-153 425,-147 431,-141 437,-141"/>
<text text-anchor="middle" x="833.5" y="-200" font-family="Times,serif" font-size="10.00">Attention</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_dec</title>
<path fill="none" stroke="#cccccc" d="M813,-220C813,-220 2140,-220 2140,-220 2146,-220 2152,-226 2152,-232 2152,-232 2152,-299 2152,-299 2152,-305 2146,-311 2140,-311 2140,-311 813,-311 813,-311 807,-311 801,-305 801,-299 801,-299 801,-232 801,-232 801,-226 807,-220 813,-220"/>
<text text-anchor="middle" x="1476.5" y="-299" font-family="Times,serif" font-size="10.00">Decoder (2&#45;layer LSTM)</text>
</g>
<!-- src_tokens -->
<g id="node1" class="node">
<title>src_tokens</title>
<polygon fill="#f5f5f5" stroke="#444444" points="123,-79 16,-79 16,-43 123,-43 123,-79"/>
<text text-anchor="middle" x="69.5" y="-64" font-family="Helvetica,sans-Serif" font-size="10.00">Source tokens (zh)</text>
<text text-anchor="middle" x="69.5" y="-53" font-family="Helvetica,sans-Serif" font-size="10.00">&lt;sos&gt; ... &lt;eos&gt;</text>
</g>
<!-- src_embed -->
<g id="node2" class="node">
<title>src_embed</title>
<polygon fill="#e8f0fe" stroke="#444444" points="231,-79 160,-79 160,-43 231,-43 231,-79"/>
<text text-anchor="middle" x="195.5" y="-64" font-family="Helvetica,sans-Serif" font-size="10.00">Embedding</text>
<text text-anchor="middle" x="195.5" y="-53" font-family="Helvetica,sans-Serif" font-size="10.00">256&#45;d</text>
</g>
<!-- src_tokens&#45;&gt;src_embed -->
<g id="edge1" class="edge">
<title>src_tokens&#45;&gt;src_embed</title>
<path fill="none" stroke="#555555" d="M123.09,-61C131.91,-61 140.99,-61 149.6,-61"/>
<polygon fill="#555555" stroke="#555555" points="149.81,-64.5 159.81,-61 149.81,-57.5 149.81,-64.5"/>
</g>
<!-- bilstm_enc -->
<g id="node3" class="node">
<title>bilstm_enc</title>
<polygon fill="#e8f0fe" stroke="#444444" points="388,-79 268,-79 268,-43 388,-43 388,-79"/>
<text text-anchor="middle" x="328" y="-64" font-family="Helvetica,sans-Serif" font-size="10.00">BiLSTM x2</text>
<text text-anchor="middle" x="328" y="-53" font-family="Helvetica,sans-Serif" font-size="10.00">hidden 512 (each dir)</text>
</g>
<!-- src_embed&#45;&gt;bilstm_enc -->
<g id="edge2" class="edge">
<title>src_embed&#45;&gt;bilstm_enc</title>
<path fill="none" stroke="#555555" d="M231.13,-61C239.45,-61 248.62,-61 257.9,-61"/>
<polygon fill="#555555" stroke="#555555" points="257.98,-64.5 267.98,-61 257.98,-57.5 257.98,-64.5"/>
</g>
<!-- enc_outputs -->
<g id="node4" class="node">
<title>enc_outputs</title>
<polygon fill="#e8f0fe" stroke="#444444" points="533.5,-106 438.5,-106 438.5,-70 533.5,-70 533.5,-106"/>
<text text-anchor="middle" x="486" y="-91" font-family="Helvetica,sans-Serif" font-size="10.00">Encoder outputs</text>
<text text-anchor="middle" x="486" y="-80" font-family="Helvetica,sans-Serif" font-size="10.00">[b, T_src, 1024]</text>
</g>
<!-- bilstm_enc&#45;&gt;enc_outputs -->
<g id="edge3" class="edge">
<title>bilstm_enc&#45;&gt;enc_outputs</title>
<path fill="none" stroke="#555555" d="M388.42,-71.28C401.47,-73.54 415.25,-75.93 428.19,-78.17"/>
<polygon fill="#555555" stroke="#555555" points="427.9,-81.67 438.35,-79.93 429.1,-74.77 427.9,-81.67"/>
</g>
<!-- enc_final -->
<g id="node5" class="node">
<title>enc_final</title>
<polygon fill="#e8f0fe" stroke="#444444" points="547,-52 425,-52 425,-16 547,-16 547,-52"/>
<text text-anchor="middle" x="486" y="-37" font-family="Helvetica,sans-Serif" font-size="10.00">Proj last fwd+bwd &#45;&gt;</text>
<text text-anchor="middle" x="486" y="-26" font-family="Helvetica,sans-Serif" font-size="10.00">Decoder init h,c (512)</text>
</g>
<!-- bilstm_enc&#45;&gt;enc_final -->
<g id="edge4" class="edge">
<title>bilstm_enc&#45;&gt;enc_final</title>
<path fill="none" stroke="#555555" d="M388.42,-50.72C397.12,-49.21 406.14,-47.65 415.02,-46.11"/>
<polygon fill="#555555" stroke="#555555" points="415.71,-49.54 424.97,-44.39 414.52,-42.65 415.71,-49.54"/>
</g>
<!-- attn_score -->
<g id="node7" class="node">
<title>attn_score</title>
<polygon fill="#fef3c7" stroke="#444444" points="772,-185 584,-185 584,-149 772,-149 772,-185"/>
<text text-anchor="middle" x="678" y="-170" font-family="Helvetica,sans-Serif" font-size="10.00">Alignment (dot / general / additive)</text>
<text text-anchor="middle" x="678" y="-159" font-family="Helvetica,sans-Serif" font-size="10.00">mask PAD &#45;&gt; scores</text>
</g>
<!-- enc_outputs&#45;&gt;attn_score -->
<g id="edge8" class="edge">
<title>enc_outputs&#45;&gt;attn_score</title>
<path fill="none" stroke="#555555" d="M530.59,-106.12C558.47,-117.72 594.8,-132.82 624.3,-145.09"/>
<polygon fill="#555555" stroke="#555555" points="623.04,-148.35 633.61,-148.96 625.72,-141.89 623.04,-148.35"/>
</g>
<!-- lstm_dec -->
<g id="node13" class="node">
<title>lstm_dec</title>
<polygon fill="#e0f7fa" stroke="#444444" points="1702,-264 1631,-264 1631,-228 1702,-228 1702,-264"/>
<text text-anchor="middle" x="1666.5" y="-249" font-family="Helvetica,sans-Serif" font-size="10.00">LSTM x2</text>
<text text-anchor="middle" x="1666.5" y="-238" font-family="Helvetica,sans-Serif" font-size="10.00">hidden 512</text>
</g>
<!-- enc_final&#45;&gt;lstm_dec -->
<g id="edge15" class="edge">
<title>enc_final&#45;&gt;lstm_dec</title>
<path fill="none" stroke="#555555" d="M534.26,-52.05C572.24,-64.94 627.28,-80 677,-80 677,-80 677,-80 1340.5,-80 1463.14,-80 1586.12,-174.9 1638.82,-221.19"/>
<polygon fill="#555555" stroke="#555555" points="1636.57,-223.88 1646.37,-227.92 1641.23,-218.65 1636.57,-223.88"/>
<text text-anchor="middle" x="982" y="-83.8" font-family="Times,serif" font-size="14.00">init h,c</text>
</g>
<!-- dec_query -->
<g id="node6" class="node">
<title>dec_query</title>
<polygon fill="#fef3c7" stroke="#444444" points="539,-185 433,-185 433,-149 539,-149 539,-185"/>
<text text-anchor="middle" x="486" y="-170" font-family="Helvetica,sans-Serif" font-size="10.00">Decoder query h_t</text>
<text text-anchor="middle" x="486" y="-159" font-family="Helvetica,sans-Serif" font-size="10.00">(top layer)</text>
</g>
<!-- dec_query&#45;&gt;attn_score -->
<g id="edge5" class="edge">
<title>dec_query&#45;&gt;attn_score</title>
<path fill="none" stroke="#555555" d="M539.17,-167C549.98,-167 561.73,-167 573.66,-167"/>
<polygon fill="#555555" stroke="#555555" points="573.71,-170.5 583.71,-167 573.71,-163.5 573.71,-170.5"/>
</g>
<!-- attn_weights -->
<g id="node8" class="node">
<title>attn_weights</title>
<polygon fill="#fef3c7" stroke="#444444" points="932,-185 816,-185 816,-149 932,-149 932,-185"/>
<text text-anchor="middle" x="874" y="-164.5" font-family="Helvetica,sans-Serif" font-size="10.00">Softmax alpha_{t,s}</text>
</g>
<!-- attn_score&#45;&gt;attn_weights -->
<g id="edge6" class="edge">
<title>attn_score&#45;&gt;attn_weights</title>
<path fill="none" stroke="#555555" d="M772.02,-167C783.37,-167 794.79,-167 805.66,-167"/>
<polygon fill="#555555" stroke="#555555" points="805.9,-170.5 815.9,-167 805.9,-163.5 805.9,-170.5"/>
</g>
<!-- context_vec -->
<g id="node9" class="node">
<title>context_vec</title>
<polygon fill="#fef3c7" stroke="#444444" points="1234,-185 1025,-185 1025,-149 1234,-149 1234,-185"/>
<text text-anchor="middle" x="1129.5" y="-164.5" font-family="Helvetica,sans-Serif" font-size="10.00">Context = sum alpha_{t,s} * enc_out_s</text>
</g>
<!-- attn_weights&#45;&gt;context_vec -->
<g id="edge7" class="edge">
<title>attn_weights&#45;&gt;context_vec</title>
<path fill="none" stroke="#555555" d="M932.21,-167C956.7,-167 986.21,-167 1014.82,-167"/>
<polygon fill="#555555" stroke="#555555" points="1014.9,-170.5 1024.9,-167 1014.9,-163.5 1014.9,-170.5"/>
</g>
<!-- concat_in -->
<g id="node12" class="node">
<title>concat_in</title>
<polygon fill="#e0f7fa" stroke="#444444" points="1408,-264 1271,-264 1271,-228 1408,-228 1408,-264"/>
<text text-anchor="middle" x="1339.5" y="-243.5" font-family="Helvetica,sans-Serif" font-size="10.00">Concat [embed; context]</text>
</g>
<!-- context_vec&#45;&gt;concat_in -->
<g id="edge11" class="edge">
<title>context_vec&#45;&gt;concat_in</title>
<path fill="none" stroke="#555555" d="M1177.96,-185.03C1208.73,-196.71 1249,-212.01 1281.5,-224.35"/>
<polygon fill="#555555" stroke="#555555" points="1280.29,-227.64 1290.89,-227.92 1282.78,-221.09 1280.29,-227.64"/>
</g>
<!-- tgt_prev_tok -->
<g id="node10" class="node">
<title>tgt_prev_tok</title>
<polygon fill="#e0f7fa" stroke="#444444" points="939,-274 809,-274 809,-238 939,-238 939,-274"/>
<text text-anchor="middle" x="874" y="-259" font-family="Helvetica,sans-Serif" font-size="10.00">Prev target token</text>
<text text-anchor="middle" x="874" y="-248" font-family="Helvetica,sans-Serif" font-size="10.00">(teacher forcing p=0.5)</text>
</g>
<!-- tgt_embed -->
<g id="node11" class="node">
<title>tgt_embed</title>
<polygon fill="#e0f7fa" stroke="#444444" points="1165,-264 1094,-264 1094,-228 1165,-228 1165,-264"/>
<text text-anchor="middle" x="1129.5" y="-249" font-family="Helvetica,sans-Serif" font-size="10.00">Embedding</text>
<text text-anchor="middle" x="1129.5" y="-238" font-family="Helvetica,sans-Serif" font-size="10.00">256&#45;d</text>
</g>
<!-- tgt_prev_tok&#45;&gt;tgt_embed -->
<g id="edge9" class="edge">
<title>tgt_prev_tok&#45;&gt;tgt_embed</title>
<path fill="none" stroke="#555555" d="M939.3,-253.46C984.5,-251.68 1043.83,-249.34 1083.91,-247.76"/>
<polygon fill="#555555" stroke="#555555" points="1084.06,-251.26 1093.92,-247.36 1083.79,-244.26 1084.06,-251.26"/>
</g>
<!-- tgt_embed&#45;&gt;concat_in -->
<g id="edge10" class="edge">
<title>tgt_embed&#45;&gt;concat_in</title>
<path fill="none" stroke="#555555" d="M1165.31,-246C1191.31,-246 1227.85,-246 1260.67,-246"/>
<polygon fill="#555555" stroke="#555555" points="1260.73,-249.5 1270.73,-246 1260.73,-242.5 1260.73,-249.5"/>
</g>
<!-- concat_in&#45;&gt;lstm_dec -->
<g id="edge12" class="edge">
<title>concat_in&#45;&gt;lstm_dec</title>
<path fill="none" stroke="#555555" d="M1408.24,-246C1472.03,-246 1565.76,-246 1620.72,-246"/>
<polygon fill="#555555" stroke="#555555" points="1620.85,-249.5 1630.85,-246 1620.85,-242.5 1620.85,-249.5"/>
</g>
<!-- proj_softmax -->
<g id="node14" class="node">
<title>proj_softmax</title>
<polygon fill="#e0f7fa" stroke="#444444" points="1967,-264 1739,-264 1739,-228 1967,-228 1967,-264"/>
<text text-anchor="middle" x="1853" y="-243.5" font-family="Helvetica,sans-Serif" font-size="10.00">[h_t; context; embed] &#45;&gt; Linear &#45;&gt; Softmax</text>
</g>
<!-- lstm_dec&#45;&gt;proj_softmax -->
<g id="edge13" class="edge">
<title>lstm_dec&#45;&gt;proj_softmax</title>
<path fill="none" stroke="#555555" d="M1702.2,-246C1710.26,-246 1719.29,-246 1728.82,-246"/>
<polygon fill="#555555" stroke="#555555" points="1728.92,-249.5 1738.92,-246 1728.91,-242.5 1728.92,-249.5"/>
</g>
<!-- pred_token -->
<g id="node15" class="node">
<title>pred_token</title>
<polygon fill="#e0f7fa" stroke="#444444" points="2144,-274 2004,-274 2004,-238 2144,-238 2144,-274"/>
<text text-anchor="middle" x="2074" y="-253.5" font-family="Helvetica,sans-Serif" font-size="10.00">Pred token / beam search</text>
</g>
<!-- proj_softmax&#45;&gt;pred_token -->
<g id="edge14" class="edge">
<title>proj_softmax&#45;&gt;pred_token</title>
<path fill="none" stroke="#555555" d="M1967.03,-251.16C1976.05,-251.57 1985.04,-251.98 1993.75,-252.38"/>
<polygon fill="#555555" stroke="#555555" points="1993.68,-255.88 2003.83,-252.84 1994,-248.89 1993.68,-255.88"/>
</g>
<!-- pred_token&#45;&gt;tgt_prev_tok -->
<g id="edge16" class="edge">
<title>pred_token&#45;&gt;tgt_prev_tok</title>
<path fill="none" stroke="#555555" stroke-dasharray="5,2" d="M2003.91,-268.7C1991.66,-270.49 1978.98,-272.05 1967,-273 1549.66,-306.25 1443,-296.61 1025,-273 1000.27,-271.6 973.36,-268.92 949.25,-266.09"/>
<polygon fill="#555555" stroke="#555555" points="949.44,-262.59 939.1,-264.88 948.61,-269.54 949.44,-262.59"/>
<text text-anchor="middle" x="1519.5" y="-297.8" font-family="Times,serif" font-size="14.00">greedy/beam free running</text>
</g>
</g>
</svg>
